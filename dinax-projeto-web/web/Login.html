<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <link rel="stylesheet" href="Biblioteca/Bootstrap/bootstrap.css"> 
        <script src="Biblioteca/jQuery/jquery.min.js" type="text/javascript"></script>      
        <script src="Biblioteca/CryptoJs/core.js" type="text/javascript"></script>
        <script src="Biblioteca/CryptoJs/enc-base64.js" type="text/javascript"></script>
        <script src="Biblioteca/CryptoJs/hmac.js" type="text/javascript"></script>
        <script src="Biblioteca/CryptoJs/sha256.js" type="text/javascript"></script>
        
        <script>
        $(document).ready(function(){
            $("input").blur(function(){
            if(($(this).val() == "")||($(this).val().trim() == "")){
                    $(this).css({"border-color" : "#F00", "padding": "2px"});
                }           
            });
        })          
        
        function getBase64Encode(rawStr){            
            var wordArray = CryptoJS.enc.Utf8.parse(rawStr);
            var result = CryptoJS.enc.Base64.stringify(wordArray);              
            return result;           
        }
        
        
        function createJsonHeader(){
             
            var header = 
                {        
                      "alg": "HS256",
                      "typ": "JWT"
                };
            var headerText = JSON.stringify(header, null, 2);
            return headerText;
               
        }
        
        function createJsonPayload(){
            var payload = 
                {        
                    "iss": "Service Login",
                    "name": "Daniela",
                    "admin": true,
                    "login": document.getElementById("txtUser").value                   
                };                
                        
            var payloadText = JSON.stringify(payload, null, 2);
                
            return payloadText;           
        }
        
        function createJWT(){              
                
        var txtHeader = createJsonHeader(); 
        alert(txtHeader);
        var txtPayload = createJsonPayload();  
        alert(txtPayload);
         
        var txtSecret = document.getElementById("txtPassword");
        var resultJWT = document.getElementById("txtResult"); 
        
        var base64Header = getBase64Encode(txtHeader);
        var base64Payload = getBase64Encode(txtPayload);
         
        
        var signature = CryptoJS.HmacSHA256(base64Header + "." + base64Payload, txtSecret.value); 
        var base64Sign = CryptoJS.enc.Base64.stringify(signature);       
        var jwt = (base64Header + "." + base64Payload + "." + base64Sign);
       
        
        resultJWT.innerText = jwt;

        }
    
        </script>
            
        <title>Login</title>
    </head>

    <body>
        <nav class="navbar navbar-default">
            <div class="collapse navbar-collapse" id="topFixedNavbar1">
                <div class="col-md-2"><a><img src="Biblioteca/Imagens/LogoMarca 5.png" /></a></div>
        </nav>
        <div class="container-fluid">    
            <div id="loginbox" style="margin-top:50px;" class="mainbox col-md-5 col-md-offset-3 col-sm-8 col-sm-offset-2">                    
                <div class="panel panel-info" >
                    <div class="panel-heading">
                        <div class="panel-title"> Login</div>
                        <div style="float:right; font-size: 80%; position: relative; top:-10px"><a href="#">Esqueceu a senha?</a></div>
                    </div>     

                    <div style="padding-top:30px" class="panel-body" >

                        <div style="display:none" id="login-alert" class="alert alert-danger col-sm-12"></div>

                        <form id="loginform" class="form-horizontal" role="form" action="teste" method="POST">

                            <div style="margin-bottom: 25px" class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-user"></i></span>
                                <input id="txtUser" type="text" class="form-control" name="txtUser" value="" placeholder="email ou nome de usuario" >                                        
                            </div>

                            <div style="margin-bottom: 25px" class="input-group">
                                <span class="input-group-addon"><i class="glyphicon glyphicon-lock"></i></span>
                                <input id="txtPassword" type="password" class="form-control" name="txtPassword" placeholder="Senha" value="">
                            </div>

                            <div style="margin-top:10px" class="form-group">
                                <!-- Button -->

                                <div class="col-sm-12 controls">
                                    <button id="btn-login" type="button" class="btn btn-success" onclick="createJWT()" value="login">Entrar</button>

                                </div>
                            </div>


                            <div class="form-group">

                            </div>    
                        </form>   
                        
                        <div>
                            <label> Resultado: </label>
                            <br>
                            <span id="txtResult"></span>
                            
                        </div>
                    </div>                     
                </div>  

                </body>
                </html>
